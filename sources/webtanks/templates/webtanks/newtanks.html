{% load staticfiles %}
<html>
	<head>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<script>
	var tank = new Image();
 	var oldBack = new Image();
	var back = new Image();
	var ctx;
	var type = 1;
	//var oldBack = new Image();
	var oldtankX = 120;
	var oldtankY = 690;
	var datakey = 1;
	var example;
	var line_1;
	var img = new Image();
	function game() {
            	example = document.getElementById('example'),
		example.getContext;            	
		ctx     = example.getContext('2d');
	    	ctx.fillStyle = '#FFC552';
    	    	ctx.fillRect(100, 100, 924, 620);
		ctx.fill();
	    	ctx     = example.getContext('2d');
	    	ctx.fillStyle = 'gray';
	    	ctx.fillRect(100, 90, 934, 16);
            	ctx.fillRect(90, 90,16, 640);
	    	ctx.fillRect(100, 714, 924, 16);
	    	ctx.fillRect(1018, 100, 16, 630);
	    	ctx.fillRect(100, 200, 724, 6);
            	ctx.fillRect(300, 620, 724, 6);
            	ctx.fillRect(400, 300, 6, 250);
            	ctx.fillRect(700, 300, 6, 250);
		ctx.fill();	    	
		ctx     = example.getContext('2d');
	    	ctx.fillStyle = '#BCF4FF';
            	ctx.fillRect(824, 200, 194, 6);
            	ctx.fillRect(106, 620, 200, 6);
            	ctx.fillRect(550, 206, 6, 414);
	    	ctx.fillRect(106, 420, 294, 6);
                ctx.fillRect(706, 420, 312, 6);
		ctx.fill();
		//makeTank();
		window.addEventListener('keydown', whatKey, true);
		
	}
	function change(type, X, Y)
	{
		
		switch (type){	//1 - up; //2 - down //3 - right // 4 - left
		case 1:
			img.src = '{% static 'webtanks/images/tank2.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			break;
		case 2:
			img.src = '{% static 'webtanks/images/tank3.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			break;
		case 3:
			img.src = '{% static 'webtanks/images/tank1.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			
			break;
		case 4:
			img.src = '{% static 'webtanks/images/tank4.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			break;
		case 5:
			img.src = '{% static 'webtanks/images/tank6.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			break;
		case 6:
			img.src = '{% static 'webtanks/images/tank7.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			break;
		case 7:
			img.src = '{% static 'webtanks/images/tank5.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			
			break;
		case 8:
			img.src = '{% static 'webtanks/images/tank8.png' %}';
      			img.onload = function(){
				ctx.drawImage(img, 100, 100, 800, 800, X, Y, 20, 20);
			}
			break;
		}
	}

	function flight(num)
	{
		var X = 0;
		var Y = 0;
		var type = 0;
		$.ajax({
	  			type: 'POST',
	  			url: "flight/",
				data: {'name': num,},
				dataType: 'json',
	  			success: function(arr){
					type = arr[0];
					X = arr[1];
					Y = arr[2];					
					num = arr[3];
					if(type==2)
					{
	   					img.src = '{% static 'webtanks/images/bullet.png' %}';
      						img.onload = function(){
							ctx.drawImage(img, 0, 0, 280, 280, X, Y, 5, 5);
						}
						ctx.fillStyle = '#FFC552';
       						ctx.rect(X, Y, 5, 5);
        					ctx.fill();
						flight(num);
					}
					else
					{
						//alert('game over');
					}
	  			},
				error: function(xhr, errmsg, err){
						alert(xhr.status + ": " + xhr.responseText);
					}	
					
			});
	}
	

	function whatKey(evt) {
        	oldBack = back;
		var type = 0;
		var X = 0;
		var Y = 0;
		var fX = 0;
		var fY = 0;
		var num = 0;
		var numer = 0;
		switch (evt.keyCode) {
		case 37:
			datakey = 1;
			$.ajax({
	  			type: 'POST',
	  			url: "treating/",
	  			data: {'name': 1,},
				dataType: 'json',
	  			success: function(arr){
					type = arr[0];
					X = arr[1];
					Y = arr[2];
					if(type==1)
					{
	   					ctx.fillStyle = '#FFC552';
       						ctx.rect(X, Y, 24, 24);
        					ctx.fill();	
						if (num != 1)
						{
							change(1, X, Y);
							num = 1;
						}
						else
						{
							change(5, X, Y);
							num = 5;
						}
					}
					else
					{
						alert('game over')
					}
	  			},
				error: function(xhr, errmsg, err){
						alert(xhr.status + ": " + xhr.responseText);
					}	
					
			});
			break;

	        case 39:
			datakey = 2;
			 $.ajax({
	  			type: 'POST',
	  			url: "treating/",
	  			data: {'name': 2,},
				dataType: 'json',
	  			success: function(arr){
					type = arr[0];
					X = arr[1];
					Y = arr[2];
					if(type==1)
					{
	   					ctx.fillStyle = '#FFC552';
       						ctx.rect(X, Y, 24, 24);
        					ctx.fill();		
						if (num != 2)
						{
							change(2, X, Y);
							num = 2;
						}
						else
						{
							change(6, X, Y);
							num = 6;
						}
					}
					else
					{
						alert('game over')
					}
	  			},
				error: function(xhr, errmsg, err){
						alert(xhr.status + ": " + xhr.responseText);
					}	
					
			});	         
			 break;

	        case 40:
			datakey = 3;
			$.ajax({
	  			type: 'POST',
	  			url: "treating/",
	  			data: {'name': 3,},
				dataType: 'json',
	  			success: function(arr){
					type = arr[0];
					X = arr[1];
					Y = arr[2];
					if(type==1)
					{
	   					ctx.fillStyle = '#FFC552';
       						ctx.rect(X, Y, 24, 24);
        					ctx.fill();	
						if (num != 4)
						{
							change(4, X, Y);
							num = 4;
						}
						else
						{
							change(8, X, Y);
							num = 8;
						}
					}
					else
					{
						alert('game over')
					}
	  			},
				error: function(xhr, errmsg, err){
						alert(xhr.status + ": " + xhr.responseText);
					}	
					
			});
          		break;

      	      	 case 38:
			datakey = 4;
			$.ajax({
	  			type: 'POST',
	  			url: "treating/",
	  			data: {'name': 4,},
				dataType: 'json',
	  			success: function(arr){
					type = arr[0];
					X = arr[1];
					Y = arr[2];
					if(type==1)
					{
	   					ctx.fillStyle = '#FFC552';
       						ctx.rect(X, Y, 24, 24);
        					ctx.fill();	
						if (num != 3)
						{
							change(3, X, Y);
							num = 3;
						}
						else
						{
							change(7, X, Y);
							num = 7;
						}
					}
					else
					{
						alert('game over')
					}
	  			},
				error: function(xhr, errmsg, err){
						alert(xhr.status + ": " + xhr.responseText);
					}	
					
			});
         		 break;
		case 32:
			$.ajax({
	  			type: 'POST',
	  			url: "treating/",
	  			data: {'name': 5,},
				dataType: 'json',
	  			success: function(arr){
					type = arr[0];
					fX = arr[1];
					fY = arr[2];
					num = arr[3];
					if(type==2)
					{
	   					img.src = '{% static 'webtanks/images/bullet.png' %}';
      						img.onload = function(){
							ctx.drawImage(img, 0, 0, 280, 280, fX, fY, 5, 5);
						}
						flight(num);
					}
					else
					{
						alert('game over')
					}
	  			},
				error: function(xhr, errmsg, err){
						alert(xhr.status + ": " + xhr.responseText);
					}	
					
			});
       		 default:
        		  //alert("Please only use the arrow keys.");
		}

        }

        </script>
	</head>
	<body onload="game()">
		<h1>
      		Tanks
    		</h1>
    		<canvas id='example' width="1034" height="730"> </canvas>
    	</body>
</html>
